- Start Date: 2019-11-13
- RFC PR: 4

# Proto Cleanup

## Summary

A large, comprehensive cleanup of our protobuf and gRPC definitions to yield better autogenerated code.

## Motivation

 Despite the use of gRPC/protobuf autogenerated code, there's a huge amount of boilerplate in the python and go clients. With a few changes to our gRPC/protobuf specs, we would be able to generate more idiomatic code. In tandem with custom gRPC compiler plugins, this would allow us to potentially autogenerate entire client libraries, rather than maintaining unwieldy boilerplate.

## Detailed design

A few changes to gRPC/protobuf code:

1) Pervasive use of comments, as higher quality gRPC compiler plugins will use these to generate docstrings.
2) [More consistent naming of enums and their values](https://github.com/pachyderm/pachyderm/issues/4130).
3) [Separate out internal-use-only protos](https://github.com/pachyderm/pachyderm/issues/3867).
4) Disambiguate function arguments. For example, `tree` vs `trees` in `FinishCommit`.
5) Break functions up into several variants when they take mutually exclusive arguments, e.g. `PutFile` and `PutFileURL` instead of just `PutFile` ([related discussion](https://github.com/pachyderm/pachyderm/issues/3859)).
6) Remove deprecated fields (e.g. `s_branch` in `CreateBranch`.)

With these changes, the code generated would be much closer to idiomatic in respective client languages. We may then be able to use gRPC compiler plugins to get the "last mile" of ergonomics and fully autogenerate client code. This would make existing, official client libraries much easier to maintain, and allow us to more trivially roll out client libraries for other languages.

## How We Teach This

N/A

## Drawbacks

Most of these changes are backwards-compatible, and would not break existing uses of Pachyderm. However:

- Point #5 would be a major break for existing Pachyderm clients.
- Point #6 would break older Pachyderm clients.

## Alternatives

 We're currently pursuing the alternative: maintaining boilerplate in official client libraries.

## Unresolved questions

N/A
